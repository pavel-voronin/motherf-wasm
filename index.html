<html>
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
  </head>
  <body>
    <div>
      <textarea id="code" cols="80" rows="10">
>++++++++[<+++++++++>-]<.>++++[<+++++++>-]<+.+++++++..+++.>>++++++[<+++++++>-]<+
+.------------.>++++++[<+++++++++>-]<+.<.+++.------.--------.>>>++++[<++++++++>-
]<+.</textarea
      >
    </div>
    <div>
      <textarea id="input" cols="80" rows="10">a\0</textarea>
    </div>
    <div>
      <b>Output:</b>
      <pre id="output"></pre>
    </div>
    <div>
      <b>Error:</b>
      <pre id="error"></pre>
    </div>
    <div>
      <button id="run">Run</button>
      <button id="terminate">Terminate</button>
    </div>

    <script type="module">
      let worker;
      let terminateButton,
        runButton,
        codeField,
        inputField,
        outputField,
        errorField;

      async function run() {
        const code = codeField.value.trim();
        const input = inputField.value.trim().replaceAll("\\0", "\0");

        outputField.innerHTML = "...";
        errorField.innerHTML = "";

        worker.postMessage({ code, input });
      }

      function terminate() {
        worker.terminate();

        outputField.innerHTML = "";
        errorField.innerHTML = "<i>terminated</i>";

        initWorker();
      }

      function initWorker() {
        worker = new Worker("worker.js", { type: "module" });

        worker.onmessage = function ({ data: { result, error } }) {
          outputField.innerHTML = "";
          errorField.innerHTML = "";

          if (result !== null) {
            outputField.innerHTML = result;
          } else if (error !== null) {
            errorField.innerHTML = error;
          }
        };
      }

      async function initialize() {
        terminateButton = document.getElementById("terminate");
        runButton = document.getElementById("run");
        codeField = document.getElementById("code");
        inputField = document.getElementById("input");
        outputField = document.getElementById("output");
        errorField = document.getElementById("error");

        runButton.addEventListener("click", run);
        terminateButton.addEventListener("click", terminate);

        initWorker();
      }

      initialize();
    </script>
  </body>
</html>
